{"filter":false,"title":"application.rb","tooltip":"/config/application.rb","undoManager":{"mark":45,"position":45,"stack":[[{"group":"doc","deltas":[{"start":{"row":3,"column":0},"end":{"row":4,"column":29},"action":"insert","lines":["require \"omniauth\"","require \"omniauth-salesforce\""]}]}],[{"group":"doc","deltas":[{"start":{"row":4,"column":29},"end":{"row":5,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":5},"action":"remove","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":5},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":24},"end":{"row":18,"column":31},"action":"remove","lines":["Central"]},{"start":{"row":18,"column":24},"end":{"row":18,"column":25},"action":"insert","lines":["E"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":25},"end":{"row":18,"column":26},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":26},"end":{"row":18,"column":27},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":27},"end":{"row":18,"column":28},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":28},"end":{"row":18,"column":29},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":29},"end":{"row":18,"column":30},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":30},"end":{"row":18,"column":31},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":0},"end":{"row":15,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":2},"end":{"row":15,"column":4},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":4},"end":{"row":17,"column":5},"action":"insert","lines":["use OmniAuth::Builder do","    provider :salesforce, ENV['SALESFORCE_KEY'], ENV['SALESFORCE_SECRET']","  end"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":0},"end":{"row":16,"column":2},"action":"insert","lines":["  "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":20,"column":4},"end":{"row":20,"column":51},"action":"remove","lines":["config.time_zone = 'Eastern Time (US & Canada)'"]},{"start":{"row":20,"column":4},"end":{"row":20,"column":51},"action":"insert","lines":["config.time_zone = 'Eastern Time (US & Canada)'"]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":3},"end":{"row":17,"column":7},"action":"remove","lines":[" # Settings in config/environments/* take precedence over those specified here.","    # Application configuration should go into files in config/initializers","    # -- all .rb files in that directory are automatically loaded.","    use OmniAuth::Builder do","      provider :salesforce, ENV['SALESFORCE_KEY'], ENV['SALESFORCE_SECRET']","    end"]},{"start":{"row":12,"column":3},"end":{"row":80,"column":3},"action":"insert","lines":["configure do","    enable :logging","    enable :sessions","    set :show_exceptions, false","    set :session_secret, ENV['SECRET']","  end","","  use OmniAuth::Builder do","    provider :salesforce, ENV['SALESFORCE_KEY'], ENV['SALESFORCE_SECRET']","  end","","  before /^(?!\\/(auth.*))/ do   ","    redirect '/authenticate' unless session[:instance_url]","  end","","","  helpers do","    def client","      @client ||= Force.new instance_url:  session['instance_url'], ","                            oauth_token:   session['token'],","                            refresh_token: session['refresh_token'],","                            client_id:     ENV['SALESFORCE_KEY'],","                            client_secret: ENV['SALESFORCE_SECRET']","    end","","  end","","","  get '/' do","    logger.info \"Visited home page\"","    @accounts= client.query(\"select Id, Name from Account\")    ","    erb :index","  end","","","  get '/authenticate' do","    redirect \"/auth/salesforce\"","  end","","","  get '/auth/salesforce/callback' do","    logger.info \"#{env[\"omniauth.auth\"][\"extra\"][\"display_name\"]} just authenticated\"","    credentials = env[\"omniauth.auth\"][\"credentials\"]","    session['token'] = credentials[\"token\"]","    session['refresh_token'] = credentials[\"refresh_token\"]","    session['instance_url'] = credentials[\"instance_url\"]","    redirect '/'","  end","","  get '/auth/failure' do","    params[:message]","  end","","  get '/unauthenticate' do","    session.clear ","    'Goodbye - you are now logged out'","  end","","  error Force::UnauthorizedError do","    redirect \"/auth/salesforce\"","  end","","  error do","    \"There was an error.  Perhaps you need to re-authenticate to /authenticate ?  Here are the details: \" + env['sinatra.error'].name","  end","","  run! if app_file == $0","","end"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":0},"end":{"row":81,"column":0},"action":"remove","lines":["end",""]}]}],[{"group":"doc","deltas":[{"start":{"row":12,"column":0},"end":{"row":12,"column":2},"action":"insert","lines":["  "]},{"start":{"row":13,"column":0},"end":{"row":13,"column":2},"action":"insert","lines":["  "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":2},"action":"insert","lines":["  "]},{"start":{"row":15,"column":0},"end":{"row":15,"column":2},"action":"insert","lines":["  "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":2},"action":"insert","lines":["  "]},{"start":{"row":17,"column":0},"end":{"row":17,"column":2},"action":"insert","lines":["  "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":2},"action":"insert","lines":["  "]},{"start":{"row":19,"column":0},"end":{"row":19,"column":2},"action":"insert","lines":["  "]},{"start":{"row":20,"column":0},"end":{"row":20,"column":2},"action":"insert","lines":["  "]},{"start":{"row":21,"column":0},"end":{"row":21,"column":2},"action":"insert","lines":["  "]},{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["  "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["  "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":2},"action":"insert","lines":["  "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["  "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["  "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":2},"action":"insert","lines":["  "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":2},"action":"insert","lines":["  "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":2},"action":"insert","lines":["  "]},{"start":{"row":32,"column":0},"end":{"row":32,"column":2},"action":"insert","lines":["  "]},{"start":{"row":33,"column":0},"end":{"row":33,"column":2},"action":"insert","lines":["  "]},{"start":{"row":34,"column":0},"end":{"row":34,"column":2},"action":"insert","lines":["  "]},{"start":{"row":35,"column":0},"end":{"row":35,"column":2},"action":"insert","lines":["  "]},{"start":{"row":36,"column":0},"end":{"row":36,"column":2},"action":"insert","lines":["  "]},{"start":{"row":37,"column":0},"end":{"row":37,"column":2},"action":"insert","lines":["  "]},{"start":{"row":38,"column":0},"end":{"row":38,"column":2},"action":"insert","lines":["  "]},{"start":{"row":39,"column":0},"end":{"row":39,"column":2},"action":"insert","lines":["  "]},{"start":{"row":40,"column":0},"end":{"row":40,"column":2},"action":"insert","lines":["  "]},{"start":{"row":41,"column":0},"end":{"row":41,"column":2},"action":"insert","lines":["  "]},{"start":{"row":42,"column":0},"end":{"row":42,"column":2},"action":"insert","lines":["  "]},{"start":{"row":43,"column":0},"end":{"row":43,"column":2},"action":"insert","lines":["  "]},{"start":{"row":44,"column":0},"end":{"row":44,"column":2},"action":"insert","lines":["  "]},{"start":{"row":45,"column":0},"end":{"row":45,"column":2},"action":"insert","lines":["  "]},{"start":{"row":46,"column":0},"end":{"row":46,"column":2},"action":"insert","lines":["  "]},{"start":{"row":47,"column":0},"end":{"row":47,"column":2},"action":"insert","lines":["  "]},{"start":{"row":48,"column":0},"end":{"row":48,"column":2},"action":"insert","lines":["  "]},{"start":{"row":49,"column":0},"end":{"row":49,"column":2},"action":"insert","lines":["  "]},{"start":{"row":50,"column":0},"end":{"row":50,"column":2},"action":"insert","lines":["  "]},{"start":{"row":51,"column":0},"end":{"row":51,"column":2},"action":"insert","lines":["  "]},{"start":{"row":52,"column":0},"end":{"row":52,"column":2},"action":"insert","lines":["  "]},{"start":{"row":53,"column":0},"end":{"row":53,"column":2},"action":"insert","lines":["  "]},{"start":{"row":54,"column":0},"end":{"row":54,"column":2},"action":"insert","lines":["  "]},{"start":{"row":55,"column":0},"end":{"row":55,"column":2},"action":"insert","lines":["  "]},{"start":{"row":56,"column":0},"end":{"row":56,"column":2},"action":"insert","lines":["  "]},{"start":{"row":57,"column":0},"end":{"row":57,"column":2},"action":"insert","lines":["  "]},{"start":{"row":58,"column":0},"end":{"row":58,"column":2},"action":"insert","lines":["  "]},{"start":{"row":59,"column":0},"end":{"row":59,"column":2},"action":"insert","lines":["  "]},{"start":{"row":60,"column":0},"end":{"row":60,"column":2},"action":"insert","lines":["  "]},{"start":{"row":61,"column":0},"end":{"row":61,"column":2},"action":"insert","lines":["  "]},{"start":{"row":62,"column":0},"end":{"row":62,"column":2},"action":"insert","lines":["  "]},{"start":{"row":63,"column":0},"end":{"row":63,"column":2},"action":"insert","lines":["  "]},{"start":{"row":64,"column":0},"end":{"row":64,"column":2},"action":"insert","lines":["  "]},{"start":{"row":65,"column":0},"end":{"row":65,"column":2},"action":"insert","lines":["  "]},{"start":{"row":66,"column":0},"end":{"row":66,"column":2},"action":"insert","lines":["  "]},{"start":{"row":67,"column":0},"end":{"row":67,"column":2},"action":"insert","lines":["  "]},{"start":{"row":68,"column":0},"end":{"row":68,"column":2},"action":"insert","lines":["  "]},{"start":{"row":69,"column":0},"end":{"row":69,"column":2},"action":"insert","lines":["  "]},{"start":{"row":70,"column":0},"end":{"row":70,"column":2},"action":"insert","lines":["  "]},{"start":{"row":71,"column":0},"end":{"row":71,"column":2},"action":"insert","lines":["  "]},{"start":{"row":72,"column":0},"end":{"row":72,"column":2},"action":"insert","lines":["  "]},{"start":{"row":73,"column":0},"end":{"row":73,"column":2},"action":"insert","lines":["  "]},{"start":{"row":74,"column":0},"end":{"row":74,"column":2},"action":"insert","lines":["  "]},{"start":{"row":75,"column":0},"end":{"row":75,"column":2},"action":"insert","lines":["  "]},{"start":{"row":76,"column":0},"end":{"row":76,"column":2},"action":"insert","lines":["  "]},{"start":{"row":77,"column":0},"end":{"row":77,"column":2},"action":"insert","lines":["  "]},{"start":{"row":78,"column":0},"end":{"row":78,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":0},"end":{"row":4,"column":29},"action":"remove","lines":["require \"omniauth\"","require \"omniauth-salesforce\""]},{"start":{"row":3,"column":0},"end":{"row":6,"column":29},"action":"insert","lines":["require \"sinatra/base\"","require 'force'","require \"omniauth\"","require \"omniauth-salesforce\""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":6},"end":{"row":15,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":6},"end":{"row":16,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":25,"column":4},"end":{"row":25,"column":5},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":26,"column":6},"end":{"row":26,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":4},"end":{"row":27,"column":5},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":6},"end":{"row":17,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":30,"column":4},"end":{"row":30,"column":5},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":31,"column":6},"end":{"row":31,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":32,"column":8},"end":{"row":32,"column":9},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":30},"end":{"row":33,"column":31},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":34,"column":30},"end":{"row":34,"column":31},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":35,"column":30},"end":{"row":35,"column":31},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":36,"column":30},"end":{"row":36,"column":31},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":6},"end":{"row":37,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":0},"end":{"row":38,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":37,"column":10},"end":{"row":38,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":38,"column":4},"end":{"row":38,"column":5},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":41,"column":4},"end":{"row":41,"column":5},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":45,"column":4},"end":{"row":45,"column":5},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":42,"column":6},"end":{"row":42,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":43,"column":6},"end":{"row":43,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":44,"column":6},"end":{"row":44,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":3,"column":0},"end":{"row":4,"column":0},"action":"remove","lines":["require \"sinatra/base\"",""]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":5},"end":{"row":13,"column":6},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":6},"end":{"row":17,"column":7},"action":"insert","lines":["#"]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":5},"action":"insert","lines":["#"]}]}]]},"ace":{"folds":[],"scrolltop":900,"scrollleft":0,"selection":{"start":{"row":18,"column":5},"end":{"row":18,"column":5},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":55,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1424370829482,"hash":"c5b70bd1d46f63321ddc416b11ebc2b6cacdc951"}